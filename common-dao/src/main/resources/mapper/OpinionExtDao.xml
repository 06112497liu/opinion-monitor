<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bbd.dao.OpinionExtDao">
  <!--查询待处理预警舆情top10-->
  <select id="selectWarnOpinionTopTen" resultType="com.bbd.param.OpinionVo">
    SELECT
        a.id,
        a.uuid,
        a.title,
        a.hot,
        CASE
            WHEN a.hot BETWEEN (SELECT min FROM bbd_warn_setting WHERE type = 3 AND level = 1) AND (SELECT max FROM bbd_warn_setting WHERE type = 3 AND level = 1) THEN '1级'
            WHEN a.hot BETWEEN (SELECT min FROM bbd_warn_setting WHERE type = 3 AND level = 2) AND (SELECT max FROM bbd_warn_setting WHERE type = 3 AND level = 2) THEN '2级'
            WHEN a.hot BETWEEN (SELECT min FROM bbd_warn_setting WHERE type = 3 AND level = 3) AND (SELECT max FROM bbd_warn_setting WHERE type = 3 AND level = 3) THEN '3级'
        END as level,
        a.start_time as startTime
    FROM
        bbd_opinion a
    LEFT JOIN bbd_opinion_status b ON a.uuid = b.uuid
    WHERE
        b.`status` = 0
    AND b.operator = -1
    AND a.hot > (SELECT min FROM bbd_warn_setting WHERE type = 3 AND level = 3)
    ORDER BY a.hot DESC
    LIMIT 2;
  </select>
</mapper>